<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SK Bank - Zero Balance Account Opening</title>

<style>
body{
    font-family:Arial;
    background:#e9f2ff;
    padding:20px;
}
#formBox{
    width:420px;
    margin:auto;
    background:#fff;
    padding:20px;
    border-radius:10px;
    box-shadow:0 0 10px #aaa;
}
input{
    width:100%;
    padding:8px;
    margin:10px 0;
    border-radius:6px;
    border:1px solid #aaa;
}
button{
    width:100%;
    padding:10px;
    background:#0072ff;
    color:#fff;
    border:none;
    border-radius:6px;
    font-size:16px;
    cursor:pointer;
}
#photo{
    width:120px;
    height:120px;
    margin:auto;
    display:block;
    border:1px solid #aaa;
    object-fit:cover;
}
#otpBox{
    display:none;
    background:#eef7ff;
    padding:15px;
    margin-top:10px;
    border-radius:8px;
}
</style>
</head>

<body>

<h2 align="center">SK BANK — Zero Balance Account Opening</h2>

<div id="formBox">

<input type="text" id="aadharInput" placeholder="Enter Aadhaar Number">

<button onclick="sendOTP()">Generate OTP</button>

<div id="otpBox">
    <p><b>OTP sent successfully!</b></p>
    <input type="text" id="otpInput" placeholder="Enter OTP">
    <button onclick="verifyOTP()">Verify OTP</button>
</div>

<hr>

<img id="photo">

<p><b>Name:</b> <span id="name"></span></p>
<p><b>Mobile:</b> <span id="mobile"></span></p>
<p><b>Gender:</b> <span id="gender"></span></p>
<p><b>Date of Birth:</b> <span id="dob"></span></p>
<p><b>Address:</b> <span id="address"></span></p>

<hr>

<button onclick="openAccount()">Open Account</button>

</div>

<script>

// -----------------------------
// RANDOM GENERATORS
// -----------------------------
function randomAccount() {
    return Math.floor(100000000000000 + Math.random() * 900000000000000);
}
function randomCustomerID() {
    return Math.floor(1000000000 + Math.random() * 9000000000);
}

// -----------------------------
// GLOBAL VARIABLES
// -----------------------------
let userData = null;
let generatedOTP = null;
let otpVerified = false;

// -----------------------------
// UNIVERSAL AADHAAR DEEP SEARCH
// -----------------------------
function deepSearch(obj, aad) {
    for (let key in obj) {
        let value = obj[key];

        if (!value) continue;

        if (String(value).replace(/\D/g, "") === aad) {
            return obj;
        }

        if (typeof value === "object") {
            let result = deepSearch(value, aad);
            if (result) return result;
        }
    }
    return null;
}

// -----------------------------
// STEP 1 — GENERATE OTP
// -----------------------------
function sendOTP() {
    let aad = document.getElementById("aadharInput").value.trim();

    if (aad.length !== 12) {
        alert("Enter valid 12-digit Aadhaar number!");
        return;
    }

    generatedOTP = Math.floor(100000 + Math.random() * 900000);
    otpVerified = false;

    alert("OTP Generated: " + generatedOTP);

    document.getElementById("otpBox").style.display = "block";
}

// -----------------------------
// STEP 2 — VERIFY OTP
// -----------------------------
function verifyOTP() {
    let entered = document.getElementById("otpInput").value;

    if (entered == generatedOTP) {
        otpVerified = true;
        alert("OTP Verified Successfully!");
        fetchAadhaar();
    } else {
        alert("Invalid OTP. Try again!");
    }
}

// -----------------------------
// STEP 3 — FETCH AADHAAR AFTER OTP
// -----------------------------
function fetchAadhaar() {
    if (!otpVerified) {
        alert("Please verify OTP first!");
        return;
    }

    let aad = document.getElementById("aadharInput").value.trim();
    userData = null;

    for (let i = 0; i < localStorage.length; i++) {
        let key = localStorage.key(i);
        let raw = localStorage.getItem(key);

        try {
            let data = JSON.parse(raw);
            let found = deepSearch(data, aad);
            if (found) {
                userData = found;
                break;
            }
        } catch {}
    }

    if (!userData) {
        alert("Aadhaar not found in localStorage!");
        return;
    }

    loadAadharDetails();
}

// -----------------------------
// STEP 4 — SHOW DETAILS
// -----------------------------
function loadAadharDetails() {
    document.getElementById("photo").src = userData.photo || "";
    document.getElementById("name").innerText = (userData.fname || "") + " " + (userData.lname || "");
    document.getElementById("mobile").innerText = userData.mobile || "";
    document.getElementById("gender").innerText = userData.gender || "";
    document.getElementById("dob").innerText = userData.dob || "";

    document.getElementById("address").innerText =
        (userData.village || "") + ", " +
        (userData.district || "") + ", " +
        (userData.state || "") + ", " +
        (userData.country || "") + " - " +
        (userData.pin || "");
}

// -----------------------------
// STEP 5 — CREATE ACCOUNT
// Aadhaar can create ONLY ONE account
// -----------------------------
function openAccount() {
    if (!userData) {
        alert("Fetch Aadhaar details first!");
        return;
    }

    let aadhaar = document.getElementById("aadharInput").value;

    // ---------------------------------------
    // CHECK IF AADHAAR ALREADY REGISTERED
    // ---------------------------------------
    for (let i = 0; i < localStorage.length; i++) {
        let key = localStorage.key(i);

        if (key.startsWith("BANK_")) {
            let stored = JSON.parse(localStorage.getItem(key));

            if (stored.aadhar === aadhaar) {
                alert("This Aadhaar is already registered!\nAccount No: " + stored.account);
                return;
            }
        }
    }

    // ---------------------------------------
    // CREATE NEW ACCOUNT
    // ---------------------------------------
    let accNo = randomAccount();
    let custID = randomCustomerID();

    let bankData = {
        name : (userData.fname || "") + " " + (userData.lname || ""),
        mobile : userData.mobile,
        aadhar : aadhaar,
        account : accNo,
        customerID : custID,
        address : (userData.village || "") + " " + (userData.district || ""),
        photo : userData.photo
    };

    localStorage.setItem("BANK_" + userData.mobile, JSON.stringify(bankData));

    alert("Account Created Successfully!\nAccount No: " + accNo + "\nCustomer ID: " + custID);
}

</script>

</body>
</html>
