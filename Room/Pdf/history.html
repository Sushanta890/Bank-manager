<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SK Bank ‚Äì Full Transaction History</title>

<style>
body{
    font-family:Arial;
    background:#e9f2ff;
    padding:20px;
}

#mainBox{
    width:95%;
    margin:auto;
    padding:20px;
    background:white;
    border-radius:10px;
    box-shadow:0 0 10px #999;
}

h2{text-align:center;}

#balanceSummary{
    background:#eef7ff;
    padding:15px;
    border-radius:10px;
    margin-bottom:20px;
    font-size:16px;
}

.tableBox{
    width:48%;
    background:#f7faff;
    padding:15px;
    border-radius:10px;
    border:1px solid #ccc;
    height:420px;
    overflow:auto;
}

table{width:100%; border-collapse:collapse;}

th{
    background:#007bff;
    color:white;
    padding:8px;
    font-size:15px;
}

td{
    padding:6px;
    border-bottom:1px solid #ccc;
    font-size:14px;
}

.rowAnim{
    animation:fadeIn 0.6s;
}

@keyframes fadeIn{
    from{opacity:0; transform:translateY(10px);}
    to{opacity:1; transform:translateY(0);}
}

#filterBox{
    background:#eef7ff;
    padding:15px;
    border-radius:10px;
    margin-top:20px;
}

button{
    padding:8px 15px;
    border:none;
    background:#007bff;
    color:white;
    font-size:14px;
    border-radius:6px;
    cursor:pointer;
}

/* FULL-WIDTH PENDING SECTION */
#pendingBox{
    margin-top:25px;
    background:#fff7e6;
    border:1px solid #ffb84d;
    padding:20px;
    border-radius:10px;
}

#pendingBox h3{
    text-align:center;
    color:#cc6600;
}
</style>
</head>

<body>

<h2>üìÑ SK BANK ‚Äî FULL TRANSACTION HISTORY</h2>

<div id="mainBox">

<!-- BALANCE SUMMARY -->
<div id="balanceSummary">
    <b>Total Deposits (Credit):</b> ‚Çπ<span id="totalCredit">0</span> &nbsp;&nbsp;
    <b>Total Payments (Debit):</b> ‚Çπ<span id="totalDebit">0</span> &nbsp;&nbsp;
    <b>Current Balance:</b> ‚Çπ<span id="currentBalance">0</span>
</div>

<div id="filterBox">
    <b>Select Date Range:</b><br><br>
    From: <input type="date" id="fromDate">
    To: <input type="date" id="toDate">
    <button onclick="downloadHistory()">Download</button>
    <button onclick="printHistory()">Print</button>
</div>

<br>

<div style="display:flex; justify-content:space-between;">

    <div class="tableBox">
        <h3 align="center">üí∞ Deposit Transactions</h3>
        <table id="depositTable">
            <tr>
                <th>Name</th><th>Amount</th><th>Date & Time</th>
            </tr>
        </table>
    </div>

    <div class="tableBox">
        <h3 align="center">üßæ Purchase & Bills</h3>
        <table id="otherTable">
            <tr>
                <th>Type</th><th>Amount</th><th>Date & Time</th>
            </tr>
        </table>
    </div>

</div>

<!-- PENDING PAYMENT SECTION -->
<div id="pendingBox">
    <h3>‚è≥ Deposit Pending Payments (Full List)</h3>

    <table id="pendingTable">
        <tr>
            <th>Name</th>
            <th>Amount</th>
            <th>Date & Time</th>
        </tr>
    </table>
</div>

</div>

<script>

let bankUser = null;

function loadUser() {
    let acc = sessionStorage.getItem("SK_CURRENT_ACC");

    if(!acc){
        alert("Login first!");
        window.location.href = "login.html";
        return;
    }

    for(let i=0; i<localStorage.length; i++){
        let key = localStorage.key(i);
        if(key.startsWith("BANK_")){
            let data = JSON.parse(localStorage.getItem(key));
            if(data.account == acc){
                bankUser = data;
                break;
            }
        }
    }

    if(!bankUser){
        alert("User not found!");
        return;
    }

    if(!bankUser.history) bankUser.history = [];
    if(!bankUser.pending) bankUser.pending = [];

    loadTables();
}

function loadTables(){
    let depTable = document.getElementById("depositTable");
    let othTable = document.getElementById("otherTable");
    let pendTable = document.getElementById("pendingTable");

    depTable.innerHTML =
        `<tr><th>Name</th><th>Amount</th><th>Date & Time</th></tr>`;

    othTable.innerHTML =
        `<tr><th>Type</th><th>Amount</th><th>Date & Time</th></tr>`;

    pendTable.innerHTML =
        `<tr><th>Name</th><th>Amount</th><th>Date & Time</th></tr>`;

    // CALCULATE BALANCES
    let totalCredit = 0;
    let totalDebit = 0;

    bankUser.history.forEach(t => {

        // APPROVED DEPOSITS
        if(t.type === "Deposit Approved"){
            depTable.innerHTML += `
                <tr class="rowAnim">
                    <td>${t.depositor}</td>
                    <td>‚Çπ${t.amount}</td>
                    <td>${t.datetime}</td>
                </tr>`;
            totalCredit += Number(t.amount);
        }
        // PURCHASE / BILLS
        else{
            othTable.innerHTML += `
                <tr class="rowAnim">
                    <td>${t.type}</td>
                    <td>‚Çπ${t.amount}</td>
                    <td>${t.datetime}</td>
                </tr>`;
            totalDebit += Number(t.amount);
        }
    });

    // PENDING DEPOSITS
    if(bankUser.pending.length > 0){
        bankUser.pending.forEach(p => {
            pendTable.innerHTML += `
                <tr class="rowAnim">
                    <td>${p.depositor}</td>
                    <td>‚Çπ${p.amount}</td>
                    <td>${p.datetime}</td>
                </tr>`;
        });
    }

    // UPDATE BALANCE SUMMARY
    document.getElementById("totalCredit").innerText = totalCredit;
    document.getElementById("totalDebit").innerText = totalDebit;
    document.getElementById("currentBalance").innerText = totalCredit - totalDebit;
}

function downloadHistory() {
    let f = document.getElementById("fromDate").value;
    let t = document.getElementById("toDate").value;

    if (!f || !t) {
        alert("Select both dates!");
        return;
    }

    let text = "";
    text += "==============================\n";
    text += "       SK BANK REPORT\n";
    text += "==============================\n\n";

    text += "Date Range: " + f + " to " + t + "\n";
    text += "Generated On: " + new Date().toLocaleString() + "\n\n";

    text += "----------------------------------\n";
    text += "     ‚úî APPROVED DEPOSITS\n";
    text += "----------------------------------\n";

    let found = false;

    bankUser.history.forEach(tn => {
        let d = tn.datetime.split(" ")[0];

        if (tn.type === "Deposit Approved" && d >= f && d <= t) {
            text += `Name: ${tn.depositor}\n`;
            text += `Amount: ‚Çπ${tn.amount}\n`;
            text += `Date & Time: ${tn.datetime}\n`;
            text += "----------------------------------\n";
            found = true;
        }
    });

    if (!found) text += "No deposit records found.\n";

    text += "\n----------------------------------\n";
    text += "     üìå PURCHASES & BILLS\n";
    text += "----------------------------------\n";

    let found2 = false;

    bankUser.history.forEach(tn => {
        let d = tn.datetime.split(" ")[0];

        if (tn.type !== "Deposit Approved" && d >= f && d <= t) {
            text += `Type: ${tn.type}\n`;
            text += `Amount: ‚Çπ${tn.amount}\n`;
            text += `Date & Time: ${tn.datetime}\n`;
            text += "----------------------------------\n";
            found2 = true;
        }
    });

    if (!found2) text += "No purchase/bill records found.\n";

    text += "\n----------------------------------\n";
    text += "     ‚è≥ PENDING DEPOSITS\n";
    text += "----------------------------------\n";

    if (bankUser.pending.length > 0) {
        bankUser.pending.forEach(p => {
            let d = p.datetime.split(" ")[0];
            if (d >= f && d <= t) {
                text += `Name: ${p.depositor}\n`;
                text += `Amount: ‚Çπ${p.amount}\n`;
                text += `Date & Time: ${p.datetime}\n`;
                text += "----------------------------------\n";
            }
        });
    } else {
        text += "No pending deposits found.\n";
    }

    // DOWNLOAD FILE
    let file = new Blob([text], { type: 'text/plain' });
    let a = document.createElement("a");
    a.href = URL.createObjectURL(file);
    a.download = "SK_FULL_TRANSACTION_HISTORY.txt";
    a.click();
}

function printHistory(){
    window.print();
}

loadUser();
</script>

</body>
</html>
