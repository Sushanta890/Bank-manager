<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bank Registration</title>
  <style>
    :root{--bg:#f2f7ff;--card:#fff;--accent:#0066ff;}
    body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);margin:0;padding:24px;}
    .box{max-width:700px;margin:auto;}
    .card{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.1);}
    h2{margin:0 0 10px;}
    label{display:block;margin-top:10px;font-size:14px;}
    input,select{width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;margin-top:4px;}
    button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;margin-top:12px;}
    button:hover{opacity:0.9;}
    .row{display:flex;gap:10px;}
    .result{background:#e9f3ff;border-radius:8px;padding:10px;margin-top:10px;}
  </style>
</head>
<body>
  <div class="box">
    <div class="card">
      <h2>Open Bank Account</h2>
      <form id="regForm">
        <div class="row">
          <div style="flex:1">
            <label>First Name</label>
            <input id="firstName" required>
          </div>
          <div style="flex:1">
            <label>Last Name</label>
            <input id="lastName">
          </div>
        </div>

        <label>Mobile Number</label>
        <input id="mobile" required maxlength="10">

        <label>Email ID</label>
        <input id="email" type="email">

        <label>Account Type</label>
        <select id="acctType">
          <option value="Saving">Saving</option>
          <option value="Current">Current</option>
        </select>

        <div class="row">
          <div style="flex:1">
            <label>Account Number (Auto)</label>
            <input id="acctNo" readonly>
          </div>
          <div style="flex:1">
            <label>Customer ID (Auto)</label>
            <input id="custId" readonly>
          </div>
        </div>

        <div class="row">
          <button id="gen" type="button">Generate</button>
          <button type="submit">Register</button>
        </div>
      </form>

      <hr/>
      <h3>Search by Mobile</h3>
      <div class="row">
        <input id="searchMobile" placeholder="Enter mobile number">
        <button id="searchBtn">Search</button>
      </div>
      <div id="searchResult" class="result" style="display:none;"></div>

      <hr/>
      <h3>Login by Account Number</h3>
      <div class="row">
        <input id="loginAcct" placeholder="Account number">
        <button id="loginBtn">Login</button>
      </div>
      <div id="loginMsg" style="color:red;font-size:14px;"></div>
    </div>
  </div>

<script>
const SERVER_URL = 'http://127.0.0.1:5000';  // Change to your Termux IP if needed

const acctNoEl = document.getElementById('acctNo');
const custIdEl = document.getElementById('custId');
const genBtn = document.getElementById('gen');

function randDigits(n){let s='';for(let i=0;i<n;i++)s+=Math.floor(Math.random()*10);return s;}

function generateIds(){
  acctNoEl.value = '6' + randDigits(11);
  custIdEl.value = 'C' + Date.now().toString().slice(-6);
}
genBtn.onclick = generateIds;
generateIds();

document.getElementById('regForm').addEventListener('submit',async(e)=>{
  e.preventDefault();
  const data = {
    firstName: firstName.value.trim(),
    lastName: lastName.value.trim(),
    mobile: mobile.value.trim(),
    email: email.value.trim(),
    accountType: acctType.value,
    accountNumber: acctNoEl.value,
    customerId: custIdEl.value
  };
  try{
    const res = await fetch(SERVER_URL+'/api/register',{
      method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    });
    const j=await res.json();
    if(res.ok){alert('✅ Registered! Account: '+j.accountNumber);}
    else alert('❌ '+j.error);
  }catch(err){alert('Server not reachable!');}
});

document.getElementById('searchBtn').onclick=async()=>{
  const m=searchMobile.value.trim();
  if(!m)return alert('Enter mobile');
  const res=await fetch(SERVER_URL+'/api/search?mobile='+m);
  const j=await res.json();
  const box=searchResult; box.style.display='block';
  if(j.firstName) box.innerHTML=`<b>${j.firstName} ${j.lastName}</b><br>Account: ${j.accountNumber}<br>Customer ID: ${j.customerId}`;
  else box.innerHTML='No record found!';
};

document.getElementById('loginBtn').onclick=async()=>{
  const a=loginAcct.value.trim();
  if(!a)return alert('Enter account number');
  const res=await fetch(SERVER_URL+'/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({accountNumber:a})});
  const j=await res.json();
  if(j.firstName){sessionStorage.setItem('profile',JSON.stringify(j));window.location='profile.html';}
  else loginMsg.textContent='Account not found!';
};
</script>
</body>
</html>
