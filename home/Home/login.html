<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SK Bank — Login & Home</title>
  <style>
    :root{
      --accent:#0066cc; --bg:#f3f6fb; --card:#fff; --muted:#6b7280;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter, system-ui, Arial;
      background:linear-gradient(180deg,#eaf2ff 0%,var(--bg) 100%);
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{width:100%;max-width:1100px}
    .card{background:var(--card); border-radius:12px; padding:18px; box-shadow:0 10px 30px rgba(13,38,76,0.08); margin-bottom:18px}
    .row{display:flex;gap:12px}
    .col{flex:1}
    .left{width:360px}
    h1,h2{margin:0 0 12px}
    label{display:block;font-size:13px;margin:10px 0 6px;color:var(--muted)}
    input,select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6edf7}
    button{background:var(--accent);color:#fff;border:0;padding:10px 12px;border-radius:8px;cursor:pointer}
    .ghost{background:#eef6ff;color:var(--accent)}
    .muted{color:var(--muted);font-size:13px}
    .flex{display:flex;align-items:center;gap:8px}
    .balance{font-size:22px;font-weight:700}
    .small{font-size:13px}
    .tx-list{max-height:320px;overflow:auto}
    .tx-card{padding:10px;border-radius:8px;margin-bottom:8px;background:#fff;box-shadow:0 6px 18px rgba(9,30,66,0.03)}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#f3f6ff;font-weight:700}
    .actions{display:flex;gap:8px;margin-top:10px}
    .hidden{display:none}
    .center{display:flex;align-items:center;justify-content:center}
    .note{font-size:12px;color:#475569;margin-top:8px}
    .ledger{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
    .panel{background:#fbfdff;padding:12px;border-radius:8px;min-height:120px}
    .totals{margin-top:12px;font-weight:700;text-align:right}
    .small-muted{font-size:12px;color:#6b7280}
    .inline{display:inline-block}
    .form-row{display:flex;gap:8px}
    .form-row input{flex:1}
    .show-pass{cursor:pointer;padding:6px;border-radius:6px;background:#eef6ff;color:var(--accent);border:0}
    .fade-in{animation:fadeIn .35s ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
  </style>
</head>
<body>
  <div class="app">

    <!-- LOGIN -->
    <div id="loginView" class="card left fade-in">
      <div class="flex" style="justify-content:space-between;align-items:center">
        <h2>SK Bank — Login</h2>
        <div class="muted small">Local demo</div>
      </div>

      <form id="loginForm" autocomplete="off">
        <label>Account number</label>
        <input id="loginAcc" placeholder="Enter account number" required />

        <label>Password</label>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="loginPass" type="password" placeholder="Password" style="flex:1" required />
          <button type="button" id="openRegister" class="ghost">Register</button>
        </div>

        <div class="actions" style="margin-top:12px">
          <button type="submit">Login</button>
          <button type="button" id="prefillDemo" class="ghost">Demo account</button>
        </div>
      </form>
      <div id="loginMsg" style="margin-top:10px"></div>
      <footer class="note">Tip: Registered accounts are stored in <code>localStorage</code> key <strong>skbank_accounts_v1</strong>.</footer>
    </div>

    <!-- HOME / DASHBOARD -->
    <div id="homeView" class="hidden">

      <div class="card fade-in">
        <div class="row" style="align-items:center">
          <div class="col">
            <div class="muted">Welcome back</div>
            <div id="fullName" style="font-weight:800;font-size:18px"></div>
            <div class="muted small" id="acctLine"></div>
          </div>
          <div style="text-align:right">
            <div class="muted">Available balance</div>
            <div class="balance" id="bal">₹0.00</div>
            <div class="muted small" id="custIdLine"></div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="left">
          <div class="card fade-in">
            <h3>Quick Payments</h3>
            <div class="muted small">Choose a payment type and submit — transactions will be recorded</div>

            <!-- Electrical / Gas / Rent: only amount -->
            <label style="margin-top:10px">Payment Type</label>
            <select id="payType">
              <option value="electric">Electrical Bill</option>
              <option value="gas">Gas Bill</option>
              <option value="rent">Room Rent</option>
              <option value="purchase">Item Purchase</option>
            </select>

            <div id="amountOnly" style="margin-top:10px">
              <label>Amount (₹)</label>
              <input id="payAmount" type="number" min="1" placeholder="0" />
            </div>

            <div id="purchaseBox" class="hidden" style="margin-top:10px">
              <label>Item name</label>
              <input id="itemName" placeholder="e.g. Rice (5kg)" />
              <label style="margin-top:8px">Amount (₹)</label>
              <input id="itemAmount" type="number" min="1" placeholder="0" />
            </div>

            <div class="actions">
              <button id="submitPay">Submit & Pay</button>
              <button id="downloadPdf" class="ghost">Download PDF</button>
            </div>
            <div id="payMsg" style="margin-top:8px"></div>
          </div>

          <div class="card fade-in" style="margin-top:12px">
            <h3>Transaction History</h3>
            <div class="muted small">Newest first — date & time shown</div>
            <div id="txList" class="tx-list" style="margin-top:10px"></div>
          </div>
        </div>

        <div class="col">
          <div class="card fade-in">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <h3>Account Info</h3>
              <div class="badge">Details</div>
            </div>

            <div style="margin-top:8px">
              <div class="small-muted">Account number</div>
              <div id="showAcc" style="font-weight:700"></div>

              <div class="small-muted" style="margin-top:8px">Customer ID</div>
              <div id="showCust" style="font-weight:700"></div>

              <div class="small-muted" style="margin-top:8px">Password</div>
              <div style="display:flex;gap:8px;align-items:center">
                <div id="showPass" style="font-weight:700">••••••••</div>
                <button id="togglePass" class="show-pass">Show</button>
              </div>
            </div>

            <div class="ledger" style="margin-top:12px">
              <div class="panel">
                <h4 style="margin:0 0 8px">Receipts (Debit)</h4>
                <div id="debitList" style="max-height:220px;overflow:auto"></div>
              </div>
              <div class="panel">
                <h4 style="margin:0 0 8px">Payments (Credit)</h4>
                <div id="creditList" style="max-height:220px;overflow:auto"></div>
              </div>
            </div>

            <div class="totals" id="totalsBlock"></div>

            <div style="display:flex;gap:8px;margin-top:12px">
              <button id="logoutBtn" class="ghost">Logout</button>
              <button id="backToLogin" class="ghost">Back to Login</button>
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>

<script>
/* STORAGE KEYS */
const ACC_KEY = 'skbank_accounts_v1';
const TX_KEY  = 'skbank_tx_v1';

/* helpers */
const $ = id => document.getElementById(id);
const loadAccounts = () => JSON.parse(localStorage.getItem(ACC_KEY) || '[]');
const saveAccounts = a => localStorage.setItem(ACC_KEY, JSON.stringify(a));
const loadTx = () => JSON.parse(localStorage.getItem(TX_KEY) || '[]');
const saveTx = t => localStorage.setItem(TX_KEY, JSON.stringify(t));

/* UI elements */
const loginView = $('loginView'), homeView = $('homeView');
const loginForm = $('loginForm'), loginAcc = $('loginAcc'), loginPass = $('loginPass'), loginMsg = $('loginMsg');
const openRegister = $('openRegister'), prefillDemo = $('prefillDemo');

const fullName = $('fullName'), acctLine = $('acctLine'), custIdLine = $('custIdLine'), balEl = $('bal');
const showAcc = $('showAcc'), showCust = $('showCust'), showPass = $('showPass'), togglePass = $('togglePass');

const payType = $('payType'), amountOnly = $('amountOnly'), purchaseBox = $('purchaseBox');
const payAmount = $('payAmount'), itemName = $('itemName'), itemAmount = $('itemAmount');
const submitPay = $('submitPay'), payMsg = $('payMsg');

const txList = $('txList'), debitList = $('debitList'), creditList = $('creditList'), totalsBlock = $('totalsBlock');
const logoutBtn = $('logoutBtn'), backToLogin = $('backToLogin'), downloadPdf = $('downloadPdf');

/* state */
let currentUser = null;

/* --- Registration helper (prompt-based quick register) --- */
openRegister.addEventListener('click', ()=>{
  const fname = prompt('First name:'); if(!fname) return;
  const lname = prompt('Last name:') || '';
  const mobile = prompt('Mobile (10 digits):'); if(!/^\d{10}$/.test(mobile)) return alert('Invalid mobile');
  const email = prompt('Email:') || '';
  const pass = prompt('Password (min 4 chars):'); if(!pass || pass.length<4) return alert('Password too short');

  const accounts = loadAccounts();
  // create acc/cust
  const accNum = 'AC' + Date.now().toString().slice(-6) + Math.floor(Math.random()*90);
  const custId = 'SK' + Math.floor(10000000 + Math.random()*90000000);
  if(accounts.some(a=>a.mobile === mobile)) return alert('Mobile already registered');
  accounts.push({ fname, lname, mobile, email, accNum, custId, password:pass, balance:0, createdAt:new Date().toISOString() });
  saveAccounts(accounts);
  alert('Registered!\nAccount: '+accNum+'\nCustomer ID: '+custId);
});

/* --- Pre-fill demo user (for quick testing) --- */
prefillDemo.addEventListener('click', ()=>{
  let accounts = loadAccounts();
  if(accounts.length === 0){
    const accNum = 'AC' + Date.now().toString().slice(-6);
    const custId = 'SK' + Math.floor(10000000 + Math.random()*90000000);
    const rec = { fname:'Demo', lname:'User', mobile:'9999999999', email:'demo@example.com', accNum, custId, password:'1234', balance:1000, createdAt:new Date().toISOString() };
    accounts.push(rec); saveAccounts(accounts);
    alert('Demo account created.\nAccount: '+accNum+'\nPassword: 1234');
    loginAcc.value = accNum;
  } else {
    loginAcc.value = accounts[0].accNum;
    alert('Prefill account number for first account.');
  }
});

/* --- Login --- */
loginForm.addEventListener('submit', (e)=>{
  e.preventDefault();
  const acc = loginAcc.value.trim();
  const pass = loginPass.value;
  const user = loadAccounts().find(a => a.accNum === acc);
  if(!user) return showLoginMsg('Account not found', false);
  if(user.password !== pass) return showLoginMsg('Invalid password', false);
  currentUser = user;
  openHome();
});

function showLoginMsg(txt, ok=true){
  loginMsg.innerHTML = `<div style="background:${ok? '#ecfdf5':'#fff1f2'};border-left:4px solid ${ok? '#10b981':'#ef4444'};padding:8px;border-radius:6px">${txt}</div>`;
  setTimeout(()=> loginMsg.innerHTML='', 3500);
}

/* --- show home --- */
function openHome(){
  loginView.classList.add('hidden');
  homeView.classList.remove('hidden');
  renderProfile();
  renderTransactions();
  renderLedger();
}

/* --- profile render --- */
function renderProfile(){
  fullName.textContent = `${currentUser.fname} ${currentUser.lname || ''}`;
  acctLine.textContent = `A/C: ${currentUser.accNum}`;
  custIdLine.textContent = `Customer ID: ${currentUser.custId}`;
  balEl.textContent = '₹' + (Number(currentUser.balance||0)).toFixed(2);
  showAcc.textContent = currentUser.accNum;
  showCust.textContent = currentUser.custId;
  showPass.textContent = '•'.repeat(Math.max(6, (currentUser.password||'').length));
}

/* toggle password */
let passShown = false;
togglePass.addEventListener('click', ()=>{
  passShown = !passShown;
  showPass.textContent = passShown ? currentUser.password : '•'.repeat(Math.max(6, (currentUser.password||'').length));
  togglePass.textContent = passShown ? 'Hide' : 'Show';
});

/* toggle purchase vs amount-only */
payType.addEventListener('change', ()=>{
  if(payType.value === 'purchase'){
    purchaseBox.classList.remove('hidden');
    amountOnly.classList.add('hidden');
  } else {
    purchaseBox.classList.add('hidden');
    amountOnly.classList.remove('hidden');
  }
});

/* --- Payments handler --- */
submitPay.addEventListener('click', ()=>{
  const type = payType.value;
  let particular = '';
  let amount = 0;

  if(type === 'purchase'){
    particular = (itemName.value || '').trim();
    amount = Number(itemAmount.value);
    if(!particular) return showPayMsg('Enter item name', false);
  } else {
    amount = Number(payAmount.value);
    particular = type === 'electric' ? 'Electrical Bill' : (type==='gas' ? 'Gas Bill' : 'Room Rent');
  }
  if(!amount || amount <= 0) return showPayMsg('Enter a valid amount', false);
  // check balance
  if((currentUser.balance||0) < amount) return showPayMsg('Insufficient balance', false);

  // deduct and save
  updateAccountBalance(currentUser.accNum, -amount);
  // refresh currentUser reference
  currentUser = loadAccounts().find(a => a.accNum === currentUser.accNum);

  // save tx
  const tx = loadTx();
  tx.unshift({
    id: Date.now(),
    from: currentUser.accNum,
    to: 'MANAGER-0001',
    type: (type==='purchase' ? 'Purchase' : (type==='electric' ? 'Electrical' : (type==='gas' ? 'Gas' : 'Rent'))),
    particular,
    amount: Number(amount),
    date: new Date().toISOString()
  });
  saveTx(tx);

  // UI refresh
  renderProfile(); renderTransactions(); renderLedger();
  showPayMsg('Payment successful', true);
  // clear inputs
  payAmount.value = ''; itemName.value = ''; itemAmount.value = '';
});

/* helper: show payment msg */
function showPayMsg(txt, ok=true){
  payMsg.innerHTML = `<div style="background:${ok? '#ecfdf5':'#fff1f2'};border-left:4px solid ${ok? '#10b981':'#ef4444'};padding:8px;border-radius:6px">${txt}</div>`;
  setTimeout(()=> payMsg.innerHTML = '', 3500);
}

/* update account balance in storage */
function updateAccountBalance(accNum, delta){
  const accounts = loadAccounts();
  const idx = accounts.findIndex(a => a.accNum === accNum);
  if(idx === -1) return false;
  accounts[idx].balance = (Number(accounts[idx].balance) || 0) + Number(delta);
  saveAccounts(accounts);
  return true;
}

/* --- Transactions render (list) --- */
function renderTransactions(){
  const txs = loadTx();
  if(!txs || txs.length === 0){
    txList.innerHTML = '<div class="muted small">No transactions yet</div>';
    return;
  }
  // show only those related to user (either from or to)
  const related = txs.filter(t => t.from === currentUser.accNum || t.to === currentUser.accNum);
  if(related.length === 0){
    txList.innerHTML = '<div class="muted small">No transactions yet</div>';
    return;
  }
  txList.innerHTML = related.map(t => {
    const date = new Date(t.date).toLocaleString();
    const sign = (t.from === currentUser.accNum) ? '-' : '+';
    return `<div class="tx-card">
      <div style="display:flex;justify-content:space-between"><div style="font-weight:700">${t.particular}</div><div class="muted small">${date}</div></div>
      <div style="margin-top:6px;display:flex;justify-content:space-between"><div class="small">Type: ${t.type}</div><div style="font-weight:800">${sign}₹${Number(t.amount).toFixed(2)}</div></div>
    </div>`;
  }).join('');
}

/* --- Ledger render (debits/credits & totals) --- */
function renderLedger(){
  const txs = loadTx().filter(t => t.from === currentUser.accNum || t.to === currentUser.accNum);
  const deb = txs.filter(t => t.to === currentUser.accNum);
  const cred = txs.filter(t => t.from === currentUser.accNum);

  debitList.innerHTML = deb.map(d => `<div style="padding:6px;border-radius:6px;margin-bottom:6px;background:#fff"><div style="font-weight:700">${d.particular}</div><div class="small-muted">${new Date(d.date).toLocaleString()} • ₹${Number(d.amount).toFixed(2)}</div></div>`).join('') || '<div class="muted small">No receipts</div>';

  creditList.innerHTML = cred.map(d => `<div style="padding:6px;border-radius:6px;margin-bottom:6px;background:#fff"><div style="font-weight:700">${d.particular}</div><div class="small-muted">${new Date(d.date).toLocaleString()} • ₹${Number(d.amount).toFixed(2)}</div></div>`).join('') || '<div class="muted small">No payments</div>';

  // totals
  const totalDebit = deb.reduce((s, r) => s + Number(r.amount), 0);
  const totalCredit = cred.reduce((s, r) => s + Number(r.amount), 0);
  totalsBlock.textContent = `Total Debit: ₹${totalDebit.toFixed(2)} | Total Credit: ₹${totalCredit.toFixed(2)} | Current Balance: ₹${Number(currentUser.balance).toFixed(2)}`;
}

/* --- Download simple PDF of statement (optional) --- */
downloadPdf.addEventListener('click', ()=>{
  // minimal in-browser text export (no external lib)
  const txs = loadTx().filter(t => t.from === currentUser.accNum || t.to === currentUser.accNum);
  let out = `SK Bank - Statement\nName: ${currentUser.fname} ${currentUser.lname}\nA/C: ${currentUser.accNum}\nCust ID: ${currentUser.custId}\nBalance: ₹${Number(currentUser.balance).toFixed(2)}\n\nTransactions:\n`;
  txs.forEach(t => {
    out += `${new Date(t.date).toLocaleString()} | ${t.particular} | ${t.type} | ₹${Number(t.amount).toFixed(2)}\n`;
  });
  const blob = new Blob([out], { type:'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = `${currentUser.accNum}_statement.txt`; a.click();
  URL.revokeObjectURL(url);
});

/* --- logout/back --- */
logoutBtn.addEventListener('click', ()=> {
  currentUser = null;
  homeView.classList.add('hidden');
  loginView.classList.remove('hidden');
  loginAcc.value = '';
  loginPass.value = '';
});
backToLogin.addEventListener('click', ()=> {
  currentUser = null;
  homeView.classList.add('hidden');
  loginView.classList.remove('hidden');
});

/* --- initial normalization (ensure numeric balances) --- */
(function normalize(){
  const ac = loadAccounts();
  let changed = false;
  ac.forEach(a => {
    if(a.balance === undefined){ a.balance = 0; changed = true; }
    else a.balance = Number(a.balance) || 0;
  });
  if(changed) saveAccounts(ac);
})();

</script>
</body>
</html>
